{
	"nodeid": "lookup_flickr_image_details",
	"title": "Flickr - image info",
	"type": "lookup",
	"subtype": "API",
	"description": "Flickr: Fetch image data (requires an API key)",

	"scripts": {
		"hello": 
		[
			"out.say('news', 'You added a Flickr details node'); ",
			"context.node.out_field = 'lookup_image_details'; "
		],
        "bye": "out.say('news', 'Deleted Flickr details node. Bye!'); ",
		
		"init":	[
				"if(context.node.settings.apikey == '') { ",
				"   out.say('error', 'You must give an API key!'); ",
                "   context.init_error = 'API key missing'; ",
				"}"
				],
                
		"pre_run": 
		[
			"var base_url = 'https://api.flickr.com/services/rest/?method=flickr.photos.getInfo';",
			"var format = '&format=json&nojsoncallback=?';",
			"out.url = base_url + '&photo_id=' + context.doc['id'] + format + '&api_key=' + context.node.settings.apikey"
		],
        
		"run":
		[
            "if (context.data.stat == 'fail') { ",
			"   out.say('error', context.data.message); ",
			"   context.node_error = context.data.message; ",
			"} else { ",
			"   out.say('progress', context.data.photo.title._content); ",
			"   out.value = context.data.photo;",
            "}"
		],
		"finish":"out.say('finish', 'Flickr image details fetched');"
	},
	
	"views": {
		"data_static":"<button data-bind=\"click: prevPage\">prev</button>\n<button data-bind=\"click: nextPage\">next</button>\n<div id=\"node_bar\" class=\"selected\">\n<h2 class=\"selected\">Flickr image descriptions</h2>\n</div>\n<div>\n<table>\n<thead>\n<tr>\n<th id=\"vcc\" data-bind=\"click: sort\">[count]</th>\n<th id=\"id\" data-bind=\"click: sort\">id</th>\n<th id=\"link\" >link</th>\n<th id=\"title\" >title</th>\n<th id=\"description\" >description</th>\n </tr>\n</thead>\n\n<tbody data-bind=\"foreach: collection\">\n<tr>\n<td data-bind=\"text: vcc\"></td>\n<td data-bind=\"text: id\"></td>\n<td >\n<a target=\"_blank\" data-bind=\"attr:{href: lookup_image_details.urls.url[0]._content}\">link</a>\n</td>\n<td data-bind=\"text: title\"></td>\n<td data-bind=\"text: lookup_image_details.description._content\"></td>\n\n </tr>\n </tbody>\n </table>\n</div>\n",
		"params":"no parameters",
		"settings":"<label>Flickr API key </label><input type=\"text\" name=\"apikey\" id=\"apikey\" required />"
	}

}

